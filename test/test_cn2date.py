import itertools
import pytest

from cn2date.cn2date import str2digit, parse, date_grammar
from lark import Lark, Visitor, Tree, Token
from typing import Tuple, Optional


str2digit_testdata = [
    ("17", "year", 2017),
    ("2017", "year", 2017),
    ("一七", "year", 2017),
    ("二零一七", "year", 2017),
    ("07", "year", 2007),
    ("12", "month", 12),
    ("十二", "month", 12),
    ("1", "month", 1),
    ("一", "month", 1),
    ("31", "day", 31),
    ("三十一", "day", 31),
    ("1", "day", 1),
    ("一", "day", 1),
]


@pytest.mark.parametrize("input_str,typ,expected", str2digit_testdata, ids=[i[0] for i in str2digit_testdata])
def test_str2digit(input_str: str, typ: str, expected: int):
    rst = str2digit(input_str, typ)
    assert rst == expected


class DateTreeVisitorForTest(Visitor):
    year_part: Optional[str]
    month_part: Optional[str]
    day_part: Optional[str]
    comb_part: Optional[str]
    cn_word_part: Optional[str]

    def __init__(self):
        self.year_part = None
        self.month_part = None
        self.day_part = None
        self.comb_part = None
        self.cn_word_part = None

    def years(self, tree: Tree):
        self.year_part = self.__scan_values__(tree)

    def months(self, tree: Tree):
        self.month_part = self.__scan_values__(tree)

    def days(self, tree: Tree):
        self.day_part = self.__scan_values__(tree)

    def comb(self, tree: Tree):
        self.comb_part = self.__scan_values__(tree)

    def cn_word(self, tree: Tree):
        self.cn_word_part = self.__scan_values__(tree)

    @staticmethod
    def __scan_values__(tree: Tree):
        val = ""
        for child in tree.children:
            if not isinstance(child, Token):
                raise TypeError("子节点不是 Token")
            val += child.value
        return val


test_lark_parse_testdata_dict = {
    "完整日期格式": [
        ("2021/9/10", "2021", "9", "10", None, None),
        ("2021/09/10", "2021", "09", "10", None, None),
        ("2021/09/1", "2021", "09", "1", None, None),
        ("2021/9/1", "2021", "9", "1", None, None),
        ("21/9/10", "21", "9", "10", None, None),
        ("21/09/10", "21", "09", "10", None, None),
        ("21/09/1", "21", "09", "1", None, None),
        ("21/9/1", "21", "9", "1", None, None),
        ("2021-9-10", "2021", "9", "10", None, None),
        ("2021-09-10", "2021", "09", "10", None, None),
        ("2021-09-1", "2021", "09", "1", None, None),
        ("2021-9-1", "2021", "9", "1", None, None),
        ("21-9-10", "21", "9", "10", None, None),
        ("21-09-10", "21", "09", "10", None, None),
        ("21-09-1", "21", "09", "1", None, None),
        ("21-9-1", "21", "9", "1", None, None),
        ("2021年9月10日", "2021", "9", "10", None, None),
        ("2021年09月10日", "2021", "09", "10", None, None),
        ("2021年09月10", "2021", "09", "10", None, None),
        ("2021年09月1", "2021", "09", "1", None, None),
        ("2021年9月1", "2021", "9", "1", None, None),
        ("21年9月10日", "21", "9", "10", None, None),
        ("21年09月10日", "21", "09", "10", None, None),
        ("21年09月10", "21", "09", "10", None, None),
        ("21年09月1", "21", "09", "1", None, None),
        ("21年9月1", "21", "9", "1", None, None),
        ("二零二一/九/三十一", "二零二一", "九", "三十一", None, None),
        ("二零二一/九/十", "二零二一", "九", "十", None, None),
        ("二零二一/零九/十", "二零二一", "零九", "十", None, None),
        ("二零二一/零九/一", "二零二一", "零九", "一", None, None),
        ("二零二一/九/一", "二零二一", "九", "一", None, None),
        ("二一/九/十", "二一", "九", "十", None, None),
        ("二一/零九/十", "二一", "零九", "十", None, None),
        ("二一/零九/一", "二一", "零九", "一", None, None),
        ("二一/九/一", "二一", "九", "一", None, None),
        ("二零二一-九-三十一", "二零二一", "九", "三十一", None, None),
        ("二零二一-九-十", "二零二一", "九", "十", None, None),
        ("二零二一-零九-十", "二零二一", "零九", "十", None, None),
        ("二零二一-零九-一", "二零二一", "零九", "一", None, None),
        ("二零二一-九-一", "二零二一", "九", "一", None, None),
        ("二一-九-十", "二一", "九", "十", None, None),
        ("二一-零九-十", "二一", "零九", "十", None, None),
        ("二一-零九-一", "二一", "零九", "一", None, None),
        ("二一-九-一", "二一", "九", "一", None, None),
        ("二零二一年九月三十一日", "二零二一", "九", "三十一", None, None),
        ("二零二一年九月三十一号", "二零二一", "九", "三十一", None, None),
        ("二零二一年九月三十一", "二零二一", "九", "三十一", None, None),
        ("二零二一年九月十日", "二零二一", "九", "十", None, None),
        ("二零二一年零九月十日", "二零二一", "零九", "十", None, None),
        ("二零二一年零九月十", "二零二一", "零九", "十", None, None),
        ("二零二一年零九月一", "二零二一", "零九", "一", None, None),
        ("二零二一年九月一", "二零二一", "九", "一", None, None),
        ("二一年九月十日", "二一", "九", "十", None, None),
        ("二一年零九月十日", "二一", "零九", "十", None, None),
        ("二一年零九月十", "二一", "零九", "十", None, None),
        ("二一年零九月一", "二一", "零九", "一", None, None),
        ("二一年九月一", "二一", "九", "一", None, None),
        ("二零二一年09月10号", "二零二一", "09", "10", None, None),
        ("二零二一年09/10号", "二零二一", "09", "10", None, None),
        ("二零二一/09月十号", "二零二一", "09", "十", None, None),
        ("二零二一年09-十日", "二零二一", "09", "十", None, None),
        ("二零二一年09-十号", "二零二一", "09", "十", None, None),
        ("二零二一年09-十", "二零二一", "09", "十", None, None),
        ("二零二一年09/10", "二零二一", "09", "10", None, None),
        ("二零二一年09-10", "二零二一", "09", "10", None, None),
        ("2021/九月10", "2021", "九", "10", None, None),
        ("2021/9月十", "2021", "9", "十", None, None),
        ("2021年9月10号", "2021", "9", "10", None, None),
        ("2021年09月10号", "2021", "09", "10", None, None),
        ("21年9月10号", "21", "9", "10", None, None),
        ("21年09月10号", "21", "09", "10", None, None),
        ("二零二一年九月十号", "二零二一", "九", "十", None, None),
        ("二零二一年零九月十号", "二零二一", "零九", "十", None, None),
        ("二一年九月十号", "二一", "九", "十", None, None),
        ("二一年零九月十号", "二一", "零九", "十", None, None)
    ],
    "年月格式": [
        ("2021年09月", "2021", "09", None, None, None),
        ("2021年9月", "2021", "9", None, None, None),
        ("21年09月", "21", "09", None, None, None),
        ("21年9月", "21", "9", None, None, None),
        ("二零二一年零九月", "二零二一", "零九", None, None, None),
        ("二零二一年九月", "二零二一", "九", None, None, None),
        ("二一年零九月", "二一", "零九", None, None, None),
        ("二一年九月", "二一", "九", None, None, None)
    ],
    "月日格式": [
        ("9月10日", None, "9", "10", None, None),
        ("09月10日", None, "09", "10", None, None),
        ("09月1日", None, "09", "1", None, None),
        ("9月1日", None, "9", "1", None, None),
        ("9月10号", None, "9", "10", None, None),
        ("09月10号", None, "09", "10", None, None),
        ("09月1号", None, "09", "1", None, None),
        ("9月1号", None, "9", "1", None, None),
        ("九月十日", None, "九", "十", None, None),
        ("零九月十日", None, "零九", "十", None, None),
        ("零九月一日", None, "零九", "一", None, None),
        ("九月一日", None, "九", "一", None, None),
        ("九月十号", None, "九", "十", None, None),
        ("零九月十号", None, "零九", "十", None, None),
        ("零九月一号", None, "零九", "一", None, None),
        ("九月一号", None, "九", "一", None, None),
    ],
    "年格式": [
        ("2021年", "2021", None, None, None, None),
        ("21年", "21", None, None, None, None),
        ("二零二一年", "二零二一", None, None, None, None),
        ("二一年", "二一", None, None, None, None),
    ],
    "月格式": [
        ("1月", None, "1", None, None, None),
        ("01月", None, "01", None, None, None),
        ("12月", None, "12", None, None, None),
        ("一月", None, "一", None, None, None),
        ("零一月", None, "零一", None, None, None),
        ("十二月", None, "十二", None, None, None),
        ("一二月", None, "一二", None, None, None)
    ],
    "日格式": [
        ("31日", None, None, "31", None, None),
        ("1日", None, None, "1", None, None),
        ("01日", None, None, "01", None, None),
        ("三十一日", None, None, "三十一", None, None),
        ("三一日", None, None, "三一", None, None),
        ("一日", None, None, "一", None, None),
        ("零一日", None, None, "零一", None, None)
    ],
    "中文词语格式": [
        ("今天", None, None, None, None, "今天"),
        ("本年", None, None, None, None, "本年"),
        ("本年份", None, None, None, None, "本年"),
        ("本年度", None, None, None, None, "本年"),
        ("当前年", None, None, None, None, "当前年"),
        ("当前年份", None, None, None, None, "当前年"),
        ("当前年度", None, None, None, None, "当前年"),
        ("明年", None, None, None, None, "明年"),
        ("去年", None, None, None, None, "去年"),
        ("前年", None, None, None, None, "前年"),
        ("上半年", None, None, None, None, "上半年"),
        ("下半年", None, None, None, None, "下半年"),
        ("前两年", None, None, None, None, "前两年"),
        ("前两个年", None, None, None, None, "前两年"),
        ("前两个年份", None, None, None, None, "前两年"),
        ("两年前", None, None, None, None, "两年前"),
        ("两年以前", None, None, None, None, "两年前"),
        ("两年之前", None, None, None, None, "两年前"),
        ("两年内", None, None, None, None, "两年内"),
        ("两年以内", None, None, None, None, "两年内"),
        ("两年之内", None, None, None, None, "两年内"),
        ("本月", None, None, None, None, "本月"),
        ("本月份", None, None, None, None, "本月"),
        ("本月度", None, None, None, None, "本月"),
        ("这个月", None, None, None, None, "这个月"),
        ("这个月份", None, None, None, None, "这个月"),
        ("当前月", None, None, None, None, "当前月"),
        ("当前月份", None, None, None, None, "当前月"),
        ("上月", None, None, None, None, "上月"),
        ("上月份", None, None, None, None, "上月"),
        ("上个月", None, None, None, None, "上月"),
        ("上个月份", None, None, None, None, "上月"),
        ("下月", None, None, None, None, "下月"),
        ("下月份", None, None, None, None, "下月"),
        ("下个月", None, None, None, None, "下月"),
        ("下个月份", None, None, None, None, "下月"),
        ("两月前", None, None, None, None, "两月前"),
        ("两个月前", None, None, None, None, "两月前"),
        ("两个月以前", None, None, None, None, "两月前"),
        ("两个月之前", None, None, None, None, "两月前"),
        ("前两月", None, None, None, None, "前两月"),
        ("前两个月", None, None, None, None, "前两月"),
        ("两月内", None, None, None, None, "两月内"),
        ("两个月内", None, None, None, None, "两月内"),
        ("两个月以内", None, None, None, None, "两月内"),
        ("两个月之内", None, None, None, None, "两月内"),
        ("今天", None, None, None, None, "今天"),
        ("今日", None, None, None, None, "今日"),
        ("明天", None, None, None, None, "明天"),
        ("明日", None, None, None, None, "明日"),
        ("后天", None, None, None, None, "后天"),
        ("后日", None, None, None, None, "后日"),
        ("昨天", None, None, None, None, "昨天"),
        ("昨日", None, None, None, None, "昨日"),
        ("前天", None, None, None, None, "前天"),
        ("前日", None, None, None, None, "前日"),
        ("上午", None, None, None, None, "上午"),
        ("下午", None, None, None, None, "下午"),
        ("本周", None, None, None, None, "本周"),
        ("当前周", None, None, None, None, "当前周"),
        ("本星期", None, None, None, None, "本星期"),
        ("这个星期", None, None, None, None, "这个星期"),
        ("当前星期", None, None, None, None, "当前星期"),
        ("上周", None, None, None, None, "上周"),
        ("上星期", None, None, None, None, "上星期"),
        ("上个星期", None, None, None, None, "上星期"),
        ("下周", None, None, None, None, "下周"),
        ("下星期", None, None, None, None, "下星期"),
        ("下个星期", None, None, None, None, "下星期"),
        ("前两星期", None, None, None, None, "前两星期"),
        ("前两个星期", None, None, None, None, "前两星期"),
        ("两星期前", None, None, None, None, "两星期前"),
        ("两个星期前", None, None, None, None, "两星期前"),
        ("两个星期以前", None, None, None, None, "两星期前"),
        ("两个星期之前", None, None, None, None, "两星期前"),
        ("两个星期以内", None, None, None, None, "两星期内"),
        ("两个星期之内", None, None, None, None, "两星期内"),
        ("本季度", None, None, None, None, "本季度"),
        ("这个季度", None, None, None, None, "这个季度"),
        ("当前季度", None, None, None, None, "当前季度"),
        ("上季度", None, None, None, None, "上季度"),
        ("上个季度", None, None, None, None, "上季度"),
        ("下季度", None, None, None, None, "下季度"),
        ("下个季度", None, None, None, None, "下季度"),
        ("第一季度", None, None, None, None, "一季度"),
        ("第一个季度", None, None, None, None, "一季度"),
        ("第1季度", None, None, None, None, "1季度"),
        ("第1个季度", None, None, None, None, "1季度"),
        ("一季度", None, None, None, None, "一季度"),
        ("1季度", None, None, None, None, "1季度"),
        ("第二季度", None, None, None, None, "二季度"),
        ("第二个季度", None, None, None, None, "二季度"),
        ("第2季度", None, None, None, None, "2季度"),
        ("第2个季度", None, None, None, None, "2季度"),
        ("2季度", None, None, None, None, "2季度"),
        ("二季度", None, None, None, None, "二季度"),
        ("第三季度", None, None, None, None, "三季度"),
        ("第三个季度", None, None, None, None, "三季度"),
        ("第3季度", None, None, None, None, "3季度"),
        ("第3个季度", None, None, None, None, "3季度"),
        ("三季度", None, None, None, None, "三季度"),
        ("3季度", None, None, None, None, "3季度"),
        ("第四季度", None, None, None, None, "四季度"),
        ("第四个季度", None, None, None, None, "四季度"),
        ("第4季度", None, None, None, None, "4季度"),
        ("第4个季度", None, None, None, None, "4季度"),
        ("四季度", None, None, None, None, "四季度"),
        ("4季度", None, None, None, None, "4季度"),
        ("4季度", None, None, None, None, "4季度"),
        ("前两季度", None, None, None, None, "前两季度"),
        ("前两个季度", None, None, None, None, "前两季度"),
        ("两季度前", None, None, None, None, "两季度前"),
        ("两个季度前", None, None, None, None, "两季度前"),
        ("两个季度以前", None, None, None, None, "两季度前"),
        ("两个季度之前", None, None, None, None, "两季度前"),
        ("两个季度以内", None, None, None, None, "两季度内"),
        ("两个季度之内", None, None, None, None, "两季度内"),
    ]
}

test_lark_parse_testdata = list(itertools.chain.from_iterable(test_lark_parse_testdata_dict.values()))


@pytest.mark.parametrize("input_str,expected_year,expected_month,expected_day,expected_comb,expected_cnword",
                         test_lark_parse_testdata,
                         ids=[i[0] for i in test_lark_parse_testdata])
def test_lark_parse(input_str: str,
                    expected_year: str,
                    expected_month: str,
                    expected_day: str,
                    expected_comb: str,
                    expected_cnword: str):
    tree = Lark(date_grammar).parse(input_str)
    visitor = DateTreeVisitorForTest()
    visitor.visit(tree)
    assert visitor.year_part == expected_year
    assert visitor.month_part == expected_month
    assert visitor.day_part == expected_day
    assert visitor.comb_part == expected_comb
    assert visitor.cn_word_part == expected_cnword


parse_testdata_dict = {
    "年格式": [
        ("2017年", ("2017-01-01 00:00:00", "2018-01-01 00:00:00")),
        ("二零一七年", ("2017-01-01 00:00:00", "2018-01-01 00:00:00")),
        ("17年", ("2017-01-01 00:00:00", "2018-01-01 00:00:00")),
        ("一七年", ("2017-01-01 00:00:00", "2018-01-01 00:00:00"))
    ],
    "月格式": [
        ("2017年7月", ("2017-07-01 00:00:00", "2017-08-01 00:00:00")),
        ("二零一七年七月", ("2017-07-01 00:00:00", "2017-08-01 00:00:00")),
        ("7月", ("2021-07-01 00:00:00", "2021-08-01 00:00:00")),
        ("七月", ("2021-07-01 00:00:00", "2021-08-01 00:00:00"))
    ],
    "日格式": [
        ("2017/7/23", ("2017-07-23 00:00:00", "2017-07-24 00:00:00")),
        ("2017-7-23", ("2017-07-23 00:00:00", "2017-07-24 00:00:00")),
        ("2017年7月23日", ("2017-07-23 00:00:00", "2017-07-24 00:00:00")),
        ("二零一七年七月二十三", ("2017-07-23 00:00:00", "2017-07-24 00:00:00")),
        ("二零一七年七月二十三日", ("2017-07-23 00:00:00", "2017-07-24 00:00:00")),
        ("二零一七年七月二十三日当天", ("2017-07-23 00:00:00", "2017-07-24 00:00:00")),
        ("07/11", ("2021-07-11 00:00:00", "2021-07-12 00:00:00")),
        ("07-11", ("2021-07-11 00:00:00", "2021-07-12 00:00:00")),
        ("07月11", ("2021-07-11 00:00:00", "2021-07-12 00:00:00")),
        ("07月11日", ("2021-07-11 00:00:00", "2021-07-12 00:00:00")),
        ("11日当天", ("2021-09-11 00:00:00", "2021-09-12 00:00:00")),
        ("十一日当天", ("2021-09-11 00:00:00", "2021-09-12 00:00:00"))
    ],
    "中文词语格式": [
        ("今年", ("2021-01-01 00:00:00", "2022-01-01 00:00:00")),
        ("本年", ("2021-01-01 00:00:00", "2022-01-01 00:00:00")),
        ("本年份", ("2021-01-01 00:00:00", "2022-01-01 00:00:00")),
        ("本年度", ("2021-01-01 00:00:00", "2022-01-01 00:00:00")),
        ("当前年", ("2021-01-01 00:00:00", "2022-01-01 00:00:00")),
        ("当前年份", ("2021-01-01 00:00:00", "2022-01-01 00:00:00")),
        ("当前年度", ("2021-01-01 00:00:00", "2022-01-01 00:00:00")),
        ("明年", ("2022-01-01 00:00:00", "2023-01-01 00:00:00")),
        ("去年", ("2020-01-01 00:00:00", "2021-01-01 00:00:00")),
        ("前年", ("2019-01-01 00:00:00", "2020-01-01 00:00:00")),
        ("本月", ("2021-09-01 00:00:00", "2021-10-01 00:00:00")),
        ("本月份", ("2021-09-01 00:00:00", "2021-10-01 00:00:00")),
        ("本月度", ("2021-09-01 00:00:00", "2021-10-01 00:00:00")),
        ("这个月", ("2021-09-01 00:00:00", "2021-10-01 00:00:00")),
        ("这个月份", ("2021-09-01 00:00:00", "2021-10-01 00:00:00")),
        ("当前月", ("2021-09-01 00:00:00", "2021-10-01 00:00:00")),
        ("当前月份", ("2021-09-01 00:00:00", "2021-10-01 00:00:00")),
        ("上月", ("2021-08-01 00:00:00", "2021-09-01 00:00:00")),
        ("上月份", ("2021-08-01 00:00:00", "2021-09-01 00:00:00")),
        ("上个月", ("2021-08-01 00:00:00", "2021-09-01 00:00:00")),
        ("上个月份", ("2021-08-01 00:00:00", "2021-09-01 00:00:00")),
        ("下月", ("2021-10-01 00:00:00", "2021-11-01 00:00:00")),
        ("下月份", ("2021-10-01 00:00:00", "2021-11-01 00:00:00")),
        ("下个月", ("2021-10-01 00:00:00", "2021-11-01 00:00:00")),
        ("下个月份", ("2021-10-01 00:00:00", "2021-11-01 00:00:00")),
        ("今天", ("2021-09-01 00:00:00", "2021-09-02 00:00:00")),
        ("今日", ("2021-09-01 00:00:00", "2021-09-02 00:00:00")),
        ("明天", ("2021-09-02 00:00:00", "2021-09-03 00:00:00")),
        ("明日", ("2021-09-02 00:00:00", "2021-09-03 00:00:00")),
        ("后天", ("2021-09-03 00:00:00", "2021-09-04 00:00:00")),
        ("后日", ("2021-09-03 00:00:00", "2021-09-04 00:00:00")),
        ("昨天", ("2021-08-31 00:00:00", "2021-09-01 00:00:00")),
        ("昨日", ("2021-08-31 00:00:00", "2021-09-01 00:00:00")),
        ("前天", ("2021-08-30 00:00:00", "2021-08-31 00:00:00")),
        ("前日", ("2021-08-30 00:00:00", "2021-08-31 00:00:00")),
        ("上午", ("2021-09-01 00:00:00", "2021-09-01 12:00:00")),
        ("下午", ("2021-09-01 12:00:00", "2021-09-01 19:00:00")),
        ("本周", ("2021-08-30 00:00:00", "2021-09-06 00:00:00")),
        ("当前周", ("2021-08-30 00:00:00", "2021-09-06 00:00:00")),
        ("本星期", ("2021-08-30 00:00:00", "2021-09-06 00:00:00")),
        ("这个星期", ("2021-08-30 00:00:00", "2021-09-06 00:00:00")),
        ("当前星期", ("2021-08-30 00:00:00", "2021-09-06 00:00:00")),
        ("上周", ("2021-08-23 00:00:00", "2021-08-30 00:00:00")),
        ("上星期", ("2021-08-23 00:00:00", "2021-08-30 00:00:00")),
        ("上个星期", ("2021-08-23 00:00:00", "2021-08-30 00:00:00")),
        ("下周", ("2021-09-06 00:00:00", "2021-09-13 00:00:00")),
        ("下星期", ("2021-09-06 00:00:00", "2021-09-13 00:00:00")),
        ("下个星期", ("2021-09-06 00:00:00", "2021-09-13 00:00:00")),
        ("上半年", ("2021-01-01 00:00:00", "2021-07-01 00:00:00")),
        ("下半年", ("2021-07-01 00:00:00", "2022-01-01 00:00:00")),
        ("本季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("这个季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("当前季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("上季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("上个季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("下季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00")),
        ("下个季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00")),
        ("第一季度", ("2021-01-01 00:00:00", "2021-04-01 00:00:00")),
        ("第一个季度", ("2021-01-01 00:00:00", "2021-04-01 00:00:00")),
        ("第1季度", ("2021-01-01 00:00:00", "2021-04-01 00:00:00")),
        ("第1个季度", ("2021-01-01 00:00:00", "2021-04-01 00:00:00")),
        ("一季度", ("2021-01-01 00:00:00", "2021-04-01 00:00:00")),
        ("1季度", ("2021-01-01 00:00:00", "2021-04-01 00:00:00")),
        ("第二季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("第二个季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("第2季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("第2个季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("2季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("二季度", ("2021-04-01 00:00:00", "2021-07-01 00:00:00")),
        ("第三季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("第三个季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("第3季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("第3个季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("三季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("3季度", ("2021-07-01 00:00:00", "2021-10-01 00:00:00")),
        ("第四季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00")),
        ("第四个季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00")),
        ("第4季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00")),
        ("第4个季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00")),
        ("四季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00")),
        ("4季度", ("2021-10-01 00:00:00", "2022-01-01 00:00:00"))
    ],
    "组合日期格式": [
        ("2017年上半年", ("2017-01-01 00:00:00", "2017-07-01 00:00:00")),
        ("17年上半年", ("2017-01-01 00:00:00", "2017-07-01 00:00:00")),
        ("二零一七年上半年", ("2017-01-01 00:00:00", "2017-07-01 00:00:00")),
        ("一七年上半年", ("2017-01-01 00:00:00", "2017-07-01 00:00:00")),
        ("2017年下半年", ("2017-07-01 00:00:00", "2018-01-01 00:00:00")),
        ("17年下半年", ("2017-07-01 00:00:00", "2018-01-01 00:00:00")),
        ("二零一七年下半年", ("2017-07-01 00:00:00", "2018-01-01 00:00:00")),
        ("一七年下半年", ("2017-07-01 00:00:00", "2018-01-01 00:00:00")),
        ("2019年第一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("2019年第一个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("2019年一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("2019年第1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("2019年第1个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("2019年1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("19年第一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("19年第一个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("19年一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("19年第1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("19年第1个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("19年1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("二零一九年第一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("二零一九年第一个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("二零一九年一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("二零一九年第1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("二零一九年第1个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("二零一九年1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("一九年第一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("一九年第一个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("一九年一季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("一九年第1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("一九年第1个季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("一九年1季度", ("2019-01-01 00:00:00", "2019-04-01 00:00:00")),
        ("2019年第二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("2019年第二个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("2019年二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("2019年第2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("2019年第2个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("2019年2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("19年第二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("19年第二个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("19年二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("19年第2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("19年第2个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("19年2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("二零一九年第二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("二零一九年第二个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("二零一九年二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("二零一九年第2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("二零一九年第2个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("二零一九年2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("一九年第二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("一九年第二个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("一九年二季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("一九年第2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("一九年第2个季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("一九年2季度", ("2019-04-01 00:00:00", "2019-07-01 00:00:00")),
        ("2019年第三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("2019年第三个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("2019年三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("2019年第3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("2019年第3个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("2019年3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("19年第三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("19年第三个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("19年三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("19年第3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("19年第3个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("19年3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("二零一九年第三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("二零一九年第三个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("二零一九年三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("二零一九年第3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("二零一九年第3个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("二零一九年3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("一九年第三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("一九年第三个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("一九年三季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("一九年第3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("一九年第3个季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("一九年3季度", ("2019-07-01 00:00:00", "2019-10-01 00:00:00")),
        ("2019年第四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("2019年第四个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("2019年四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("2019年第4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("2019年第4个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("2019年4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("19年第四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("19年第四个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("19年四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("19年第4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("19年第4个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("19年4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("二零一九年第四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("二零一九年第四个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("二零一九年四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("二零一九年第4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("二零一九年第4个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("二零一九年4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("一九年第四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("一九年第四个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("一九年四季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("一九年第4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("一九年第4个季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00")),
        ("一九年4季度", ("2019-10-01 00:00:00", "2020-01-01 00:00:00"))
    ]
}

parse_testdata = list(itertools.chain.from_iterable(parse_testdata_dict.values()))


@pytest.mark.parametrize("input_str,expected", parse_testdata, ids=[i[0] for i in parse_testdata])
def test_parse(input_str: str, expected: Tuple[str, str]):
    rst = parse(input_str)
    assert len(rst) == len(expected)
    for i, s in enumerate(expected):
        assert rst[i] == s
